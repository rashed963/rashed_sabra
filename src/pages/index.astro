---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";

const entries = await getCollection(
  "blog",
  ({ data }) => data.status === "published" && !data.draft
);

const latestPosts = entries
  .sort(
    (a, b) =>
      new Date(b.data.publishDate).valueOf() -
      new Date(a.data.publishDate).valueOf()
  )
  .slice(0, 3);
---

<Layout>
  <main class="container main-home">
    <section class="card hero-card">
      <p class="hero-kicker">مرحبًا، أنا</p>
      <h1 class="hero-title">Rashed Sabra</h1>
      <p class="hero-subtitle">
        مستشار وقيادي في التحول الرقمي يركز على تبسيط العمليات، الأتمتة الذكية، وبناء أنظمة عمل قابلة للتوسع.
      </p>
      <div class="hero-actions">
        <a href="/journey" class="button-link primary">الرحلة المهنية ←</a>
        <a href="/blog" class="button-link">تصفّح المدونة ←</a>
      </div>
    </section>

    <section class="card">
      <div class="section-header">
        <h2 class="section-title">أحدث المقالات</h2>
        <a href="/blog" class="meta">عرض الكل</a>
      </div>

      {latestPosts.length ? (
        <ul class="latest-list">
          {latestPosts.map((entry) => (
            <li class="latest-item">
              <a href={`/blog/${entry.slug}`} class="latest-link">{entry.data.title}</a>
              <p class="latest-description">{entry.data.description}</p>
              <time datetime={entry.data.publishDate.toISOString()} class="meta">
                {entry.data.publishDate.toLocaleDateString("ar-EG", {
                  year: "numeric",
                  month: "long",
                  day: "numeric",
                })}
              </time>
            </li>
          ))}
        </ul>
      ) : (
        <p class="muted">لا توجد مقالات منشورة بعد.</p>
      )}
    </section>
  </main>
</Layout>
