---
import "../styles/global.css";

const {
  title = "Rashed Sabra",
  description,
  lang = "ar",
  dir = "rtl",
} = Astro.props;

const pathname = Astro.url.pathname;
const navLinks = [
  { href: "/", label: "الرئيسية" },
  { href: "/journey", label: "الرحلة المهنية" },
  { href: "/blog", label: "المدونة" },
];
---

<!doctype html>
<html lang={lang} dir={dir}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    {description && <meta name="description" content={description} />}
    <title>{title}</title>
  </head>
  <body>
    <div class="site-shell">
      <header class="site-header">
        <div class="container header-inner">
          <a href="/" class="brand">راشد صبرة</a>
          <nav class="main-nav" aria-label="Primary">
            {navLinks.map((link) => {
              const active =
                link.href === "/"
                  ? pathname === "/"
                  : pathname.startsWith(link.href);
              return (
                <a
                  href={link.href}
                  class:list={["nav-link", active && "is-active"]}
                >
                  {link.label}
                </a>
              );
            })}
          </nav>
        </div>
      </header>
      <main class="site-main">
        <slot />
      </main>
      <footer class="site-footer">
        <div class="container footer-inner">
          <a
            href="https://www.linkedin.com/in/rashed-sabra"
            target="_blank"
            rel="noopener noreferrer"
            class="footer-link"
          >
            LinkedIn
          </a>
          <p class="meta footer-copy">© {new Date().getFullYear()} راشد صبرة</p>
        </div>
      </footer>
    </div>
    <script is:inline>
      (() => {
        const reducedMotion = window.matchMedia(
          "(prefers-reduced-motion: reduce)"
        ).matches;

        const header = document.querySelector(".site-header");
        const toggleHeaderState = () => {
          if (!header) return;
          header.classList.toggle("is-scrolled", window.scrollY > 8);
        };
        toggleHeaderState();
        window.addEventListener("scroll", toggleHeaderState, { passive: true });

        if (reducedMotion) return;

        const targets = document.querySelectorAll(
          ".hero-card, .journey-header, .latest-item, .card-list > li, .section-grid > .card, .timeline-card, .series-item, .series-step, .post-header, .prose > *"
        );

        targets.forEach((element, index) => {
          element.classList.add("reveal");
          element.style.setProperty("--reveal-delay", `${Math.min(index * 40, 260)}ms`);
        });

        const observer = new IntersectionObserver(
          (entries, obs) => {
            entries.forEach((entry) => {
              if (!entry.isIntersecting) return;
              entry.target.classList.add("is-visible");
              obs.unobserve(entry.target);
            });
          },
          { threshold: 0.12, rootMargin: "0px 0px -8% 0px" }
        );

        targets.forEach((element) => observer.observe(element));
      })();
    </script>
  </body>
</html>
